.deploy-config:
  image: alpine/k8s:1.14.9
  stage: deploy
  only:
    - master
  environment: ops

deploy-eng-rfc:
  extends: .deploy-config
  variables:
    NOTION_COLLECTION: 5c15d049-96d8-4b21-bbea-218b94e848c3
    NOTION_COLLECTION_VIEW: c6c785fe-787f-4916-afb4-93b6045e60ce
    NOTION_COLLECTION_FILTER: 'Open'
  script:
    - helm lint ./charts/pb-rfc-notifier
    - helm upgrade pb-rfc-notifier ./charts/pb-rfc-notifier
      --install
      --reset-values
      --wait --timeout 300s
      --namespace $KUBE_NS
      -f ./charts/pb-rfc-notifier/eng-rfc-values.yaml
      --set extraEnv.NOTION_BASE=$NOTION_BASE
      --set extraEnv.SLACK_WEBHOOK_URL=$SLACK_WEBHOOK_URL_ENG_RFC
      --set extraEnv.NOTION_API=$NOTION_API
      --set extraEnv.NOTION_COLLECTION=$NOTION_COLLECTION
      --set extraEnv.NOTION_COLLECTION_VIEW=$NOTION_COLLECTION_VIEW
      --set extraEnv.NOTION_COLLECTION_FILTER=$NOTION_COLLECTION_FILTER
      --set extraEnv.VERSION=$CI_COMMIT_SHORT_SHA

deploy-design-rfc:
  extends: .deploy-config
  variables:
    NOTION_COLLECTION: ee467c22-c068-435f-ac6c-407fbda32b48
    NOTION_COLLECTION_VIEW: 2fa347f5-849a-473b-acf3-2fb2f3667834
    NOTION_COLLECTION_FILTER: 'ðŸ›Ž Open'
  script:
    - helm lint ./charts/pb-rfc-notifier
    - helm upgrade pb-rfc-notifier ./charts/pb-rfc-notifier
      --install
      --reset-values
      --wait --timeout 300s
      --namespace $KUBE_NS
      -f ./charts/pb-rfc-notifier/design-rfc-values.yaml
      --set extraEnv.NOTION_BASE=$NOTION_BASE
      --set extraEnv.SLACK_WEBHOOK_URL=$SLACK_WEBHOOK_URL_DESIGN_RFC
      --set extraEnv.NOTION_API=$NOTION_API
      --set extraEnv.NOTION_COLLECTION=$NOTION_COLLECTION
      --set extraEnv.NOTION_COLLECTION_VIEW=$NOTION_COLLECTION_VIEW
      --set extraEnv.NOTION_COLLECTION_FILTER=$NOTION_COLLECTION_FILTER
      --set extraEnv.VERSION=$CI_COMMIT_SHORT_SHA
